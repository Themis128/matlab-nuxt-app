name: Deploy to Replit

on:
  push:
    branches: [ master, main ]
    paths-ignore:
      - '**.md'
      - 'docs/**'
      - 'mobiles-dataset-docs/**'
      - 'tests/**'
      - 'screenshots/**'
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    - run: npm ci
    - run: npm run build
    - run: npm install -g @replit/cli
    - run: echo "${{ secrets.REPLIT_API_TOKEN }}" | replit auth login --stdin
      env:
        REPLIT_API_TOKEN: ${{ secrets.REPLIT_API_TOKEN }}
    - run: |
        REPLIT_APP_ID="${{ secrets.REPLIT_APP_ID }}"
        if [ -z "$REPLIT_APP_ID" ]; then
          echo "REPLIT_APP_ID not set"
          exit 1
        fi
        echo "Deploying to Replit app: $REPLIT_APP_ID"
        replit deploy --app "$REPLIT_APP_ID"
