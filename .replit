# Replit Configuration for Mobile Finder App

# Language and runtime
language = "nodejs"

# Run script that starts both Python API and Nuxt
run = "bash start.sh"

# Entry point
entrypoint = "start.sh"

# Environment variables
[env]
NODE_ENV = "production"
PORT = "3000"
HOST = "0.0.0.0"
PYTHON_API_URL = "http://localhost:8000"
PYTHONUNBUFFERED = "1"
NUXT_TELEMETRY_DISABLED = "1"
# Disable Unity Package Manager
UPM_DISABLE = "1"
UPM_CACHE_DIR = "/tmp/upm-cache"
# Optimize for limited disk space
NODE_OPTIONS = "--max-old-space-size=512"
PYTHONPATH = "/home/runner/workspace"

# Nix packages
[nix]
channel = "stable-22_11"
file = "config/replit.nix"

# Deploy configuration - optimized for disk space
[deploy]
publicDir = ".output/public"
run = ["sh", "-c", "bash scripts/enhanced-cleanup.sh && npm run build && npm run preview"]

# Unit test
[unitTest]
language = "nodejs"

# LSP (Language Server Protocol)
[languages]

[languages.javascript]
pattern = "**/*.{js,jsx,ts,tsx,vue}"

[languages.javascript.languageServer]
start = "typescript-language-server --stdio"

[languages.python]
pattern = "**/*.py"

[languages.python.languageServer]
start = "pylsp"

# Git configuration
[gitHubImport]
requiredFiles = [".replit", "package.json", "nuxt.config.ts", "start.sh"]
optionalFiles = ["config/replit.nix"]

# Always-on configuration
[alwaysOn]
enabled = true

# Packager configuration - optimized for disk space
[packager]
language = "nodejs"
ignoredPackages = ["@types/node", "@types/unity", "unity-*", "*.unitypackage", "upm", "@upm/*"]

[packager.features]
packageSearch = false
guessImports = false
enabledForHosting = false

# Debugger configuration
[debugger]
support = true
transport = "localhost:0"
initializeMessage = { command = "initialize", arguments = { adapterID = "node" } }
launchMessage = { command = "launch", arguments = { type = "node", request = "launch", name = "Debug Nuxt App", program = "${workspaceFolder}/node_modules/.bin/nuxt", args = ["dev"], console = "integratedTerminal" } }
