# Replit Configuration for Mobile Finder App

# Language and runtime
language = "nodejs"

# Run script that starts both Python API and Nuxt
run = "bash start.sh"

# Entry point
entrypoint = "start.sh"

# Environment variables
[env]
NODE_ENV = "production"
PORT = "3000"
HOST = "0.0.0.0"
PYTHON_API_URL = "http://localhost:8000"
PYTHONUNBUFFERED = "1"
NUXT_TELEMETRY_DISABLED = "1"
# Optimize Node.js memory usage to prevent disk cache issues
NODE_OPTIONS = "--max-old-space-size=512"
# Optimize npm to reduce disk usage
NPM_CONFIG_CACHE = "/tmp/npm-cache"
NPM_CONFIG_PREFER_OFFLINE = "true"
# Optimize Nuxt build to reduce disk usage
NITRO_PRESET = "node-server"

# Nix packages
[nix]
channel = "stable-22_11"
file = "config/replit.nix"

# Deploy configuration
[deploy]
publicDir = ".output/public"
run = ["sh", "-c", "npm run build && npm run preview"]

# Unit test
[unitTest]
language = "nodejs"

# LSP (Language Server Protocol)
[languages]

[languages.javascript]
pattern = "**/*.{js,jsx,ts,tsx,vue}"

[languages.javascript.languageServer]
start = "typescript-language-server --stdio"

[languages.python]
pattern = "**/*.py"

[languages.python.languageServer]
start = "pylsp"

# Git configuration
[gitHubImport]
requiredFiles = [".replit", "package.json", "nuxt.config.ts", "start.sh"]
optionalFiles = ["config/replit.nix"]

# Always-on configuration
[alwaysOn]
enabled = true

# Packager configuration
[packager]
language = "nodejs"
ignoredPackages = ["@types/node"]

[packager.features]
packageSearch = true
guessImports = true
enabledForHosting = true

# Optimize package installation to reduce disk usage
[packager.afterInstall]
postInstall = ["npm cache clean --force"]

# Debugger configuration
[debugger]
support = true
transport = "localhost:0"
initializeMessage = { command = "initialize", arguments = { adapterID = "node" } }
launchMessage = { command = "launch", arguments = { type = "node", request = "launch", name = "Debug Nuxt App", program = "${workspaceFolder}/node_modules/.bin/nuxt", args = ["dev"], console = "integratedTerminal" } }
